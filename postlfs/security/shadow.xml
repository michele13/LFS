<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY shadow-download-http "http://pkg-shadow.alioth.debian.org/releases/shadow-&shadow-version;.tar.bz2">
  <!ENTITY shadow-download-ftp  " ">
  <!ENTITY shadow-md5sum        "a00449aa439c69287b6d472191dc2247">
  <!ENTITY shadow-size          "2.1 MB">
  <!ENTITY shadow-buildsize     "38 MB">
  <!ENTITY shadow-time          "0.3 SBU">
]>

<sect1 id="shadow" xreflabel="Shadow-&shadow-version;">
  <?dbhtml filename="shadow.html"?>

  <title>Shadow-&shadow-version;</title>

  <indexterm zone="shadow">
    <primary sortas="a-Shadow">Shadow</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction to Shadow</title>

    <para>
      <application>Shadow</application> was indeed installed in LFS and there is
      no reason to reinstall it unless you installed
      <application>CrackLib</application> after your LFS system was completed.
      If you have installed <application>CrackLib</application> after LFS, then
      reinstalling <application>Shadow</application> will enable strong password
      support.
    </para>

    <bridgehead renderas="sect3">Package Information</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Download (HTTP): <ulink url="&shadow-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Download (FTP): <ulink url="&shadow-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Download MD5 sum: &shadow-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Download size: &shadow-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimated disk space required: &shadow-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimated build time: &shadow-time;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Shadow Dependencies</bridgehead>

    <bridgehead renderas="sect4">Required</bridgehead>
    <para role="required">
      <xref linkend="cracklib"/>
    </para>

  </sect2>

  <sect2 role="installation">
    <title>Installation of Shadow</title>

    <para>
      Reinstall <application>Shadow</application> by running the following
      commands:
    </para>

<screen><userinput>sed -i 's/groups$(EXEEXT) //' src/Makefile.in &amp;&amp;
find man -name Makefile.in -exec sed -i 's/groups\.1 / /' {} \; &amp;&amp;
sed -i -e 's/ ko//' -e 's/ zh_CN zh_TW//' man/Makefile.in &amp;&amp;

sed -i -e 's@#ENCRYPT_METHOD DES@ENCRYPT_METHOD SHA512@' \
       -e 's@/var/spool/mail@/var/mail@' etc/login.defs &amp;&amp;

sed -i -e 's@PATH=/sbin:/bin:/usr/sbin:/usr/bin@&amp;:/usr/local/sbin:/usr/local/bin@' \
       -e 's@PATH=/bin:/usr/bin@&amp;:/usr/local/bin@' etc/login.defs &amp;&amp;

sed -i 's@DICTPATH.*@DICTPATH\t/lib/cracklib/pw_dict@' etc/login.defs &amp;&amp;

./configure --prefix=/usr --sysconfdir=/etc --with-libcrack &amp;&amp;
make</userinput></screen>

    <para>
      This package does not come with a test suite.
    </para>

    <para>
      Now, as the <systemitem class="username">root</systemitem> user:
    </para>

<screen role="root"><userinput>make install &amp;&amp;
mv -v /usr/bin/passwd /bin</userinput></screen>
  </sect2>

  <sect2 role="commands">
    <title>Command Explanations</title>

    <para>
      <command>sed -i 's/groups$(EXEEXT) //' src/Makefile.in</command>: This sed
      is used to suppress the installation of the <command>groups</command>
      program as the version from the <application>Coreutils</application>
      package installed during LFS is preferred.
    </para>

    <para>
      <command>find man -name Makefile.in -exec ... {} \;</command>: This
      command is used to suppress the installation of the
      <command>groups</command> man pages so the existing ones installed from
      the <application>Coreutils</application> package are not replaced.
    </para>

    <para>
      <command>sed -i -e '...' -e '...' man/Makefile.in</command>: This command
      disables the installation of Chinese and Korean manual pages, since
      <application>Man-DB</application> cannot format them properly.
    </para>

    <para>
      <command>sed -i -e 's@#ENCRYPT_METHOD DES@ENCRYPT_METHOD SHA512@' -e
      's@/var/spool/mail@/var/mail@' etc/login.defs</command>: Instead of using
      the default 'DES' method, this command modifies the installation to use
      the more secure 'SHA512' method of hashing passwords, which also allows
      passwords longer than eight characters. It also changes the obsolete
      <filename class="directory">/var/spool/mail</filename> location for user
      mailboxes that <application>Shadow</application> uses by default to the
      <filename class="directory">/var/mail</filename> location.
    </para>

    <para>
      <command>sed -i -e
      's@PATH=/sbin:/bin:/usr/sbin:/usr/bin@&amp;:/usr/local/sbin:/usr/local/bin@'
      -e 's@PATH=/bin:/usr/bin@&amp;:/usr/local/bin@' etc/login.defs</command>:
      This sed expands PATH to
      <filename class="directory">/usr/local/bin</filename> for normal and
      <systemitem class="username">root</systemitem> user and to
      <filename class="directory">/usr/local/sbin</filename> for
      <systemitem class="username">root</systemitem> user only.
    </para>

    <para>
      <command>mv -v /usr/bin/passwd /bin</command>: The
      <command>passwd</command> program may be needed during times when the
      <filename class='directory'>/usr</filename> filesystem is not mounted so
      it is moved into the root partition.
    </para>
  </sect2>

  <sect2 role="configuration">
    <title>Configuring Shadow</title>

    <para>
      <application>Shadow</application>'s stock configuration for the
      <command>useradd</command> utility may not be desirable for your
      installation. One default parameter causes <command>useradd</command> to
      create a mailbox file for any newly created user.
      <command>useradd</command> will make the group ownership of this file to
      the <systemitem class="groupname">mail</systemitem> group with 0660
      permissions. If you would prefer that these mailbox files are not created
      by <command>useradd</command>, issue the following command as the
      <systemitem class="username">root</systemitem> user:
    </para>

<screen role="root"><userinput>sed -i 's/yes/no/' /etc/default/useradd</userinput></screen>
  </sect2>

  <sect2 role="content">
    <title>Contents</title>

    <para>
      A list of the installed files, along with their short descriptions can be
      found at <ulink
      url="http://www.linuxfromscratch.org/lfs/view/development/chapter06/shadow.html#contents-shadow"/>.
    </para>

  </sect2>

</sect1>
