<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY thunderbird-homepage      "https://www.mozilla.org/thunderbird/">
  <!ENTITY thunderbird-wikipedia     "https://en.wikipedia.org/wiki/Mozilla_Thunderbird">
  <!ENTITY thunderbird-download-http "&mozilla-http;/thunderbird/releases/&thunderbird-version;/source/thunderbird-&thunderbird-version;.source.tar.xz">
  <!ENTITY thunderbird-download-ftp  "&mozilla-ftp;/thunderbird/releases/&thunderbird-version;/source/thunderbird-&thunderbird-version;.source.tar.xz">
  <!ENTITY thunderbird-md5sum        "e46b0d17809d52e6be479a1b77b6445c">
  <!ENTITY thunderbird-size          "192 MB">
  <!ENTITY thunderbird-buildsize     "3.9 GB">
  <!ENTITY thunderbird-time          "72 SBU">
]>

<sect1 id="thunderbird" xreflabel="thunderbird-&thunderbird-version;">
  <?dbhtml filename="thunderbird.html" ?>

  <title>thunderbird-&thunderbird-version;</title>

  <sect2 role="package">
    <title>Introduction</title>

    <para>
      Thunderbird is a stand-alone mail/news client based on the Mozilla
      codebase. It uses the Gecko rendering engine to enable it to display and
      compose HTML emails.
    </para>

    <bridgehead renderas="sect3">Package Information</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Homepage: <ulink url="&thunderbird-homepage;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Wikipedia: <ulink url="&thunderbird-wikipedia;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Download (HTTP): <ulink url="&thunderbird-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Download (FTP): <ulink url="&thunderbird-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Download MD5 sum: &thunderbird-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Download size: &thunderbird-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimated disk space required: &thunderbird-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimated build time: &thunderbird-time;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dependencies</bridgehead>

    <bridgehead renderas="sect4">Required</bridgehead>
    <para>
      <xref linkend="alsa-lib"/>,
      <xref linkend="mesa"/>,
      <xref linkend="gtk"/>,
      <xref linkend="unzip"/>, and
      <xref linkend="zip"/>
    </para>

    <bridgehead renderas="sect4">Recommended</bridgehead>
    <para>
      <xref linkend="libevent"/>,
      <xref linkend="libvpx"/>,
      <xref linkend="nspr"/>, and
      <xref linkend="nss"/><!-- , and
      <xref linkend="sqlite"/>
      Do not use system SQLite until TB-48/52 because it uses insecure 
      routines (FTS3) that are not built in BLFS -->
    </para>

    <note>
      <para>
        If you don't install recommended dependencies, then internal copies of
        those packages will be used. They might be tested to work, but they can
        be out of date or contain security holes.
      </para>
    </note>

    <note>
      <para>
        With Thunderbird-31.0 and later versions, you must have installed
        libressl before python2, or the build system will quickly fail with
        output including "ImportError: cannot import name HTTPSHandler". If you
        are in any doubt about this (e.g. upgrading from an older version of
        Thunderbird), check if
        <filename>/usr/lib/python2.7/lib-dynload/_ssl.so</filename> exists. If
        it does not, reinstall <xref linkend="python2"/> (after
        installing <xref linkend="libressl"/> - the latest version of any
        <emphasis>currently maintained</emphasis> version of Openssl should be
        satisfactory if already installed - if that package has not already
        been installed).
      </para>
    </note>

    <bridgehead renderas="sect4">Optional</bridgehead>
    <para>
      <xref linkend="curl"/>,
      <xref linkend="cyrus-sasl"/>, and
      <xref linkend="hunspell"/>
    </para>

  </sect2>

  <sect2>
    <title>Installation</title>

    <para>
      The configuration of Thunderbird is accomplished by creating a
      <filename>mozconfig</filename> file containing the desired configuration
      options. A default <filename>mozconfig</filename> is created below. To
      see the entire list of available configuration options (and a brief
      description of each), issue <command>mozilla/configure --help</command>.
      Create the file with the following command:
    </para>

<screen><userinput>cat &gt; mozconfig &lt;&lt; "EOF"
<literal># Uncomment these lines if you have installed optional dependencies:
#ac_add_options --enable-system-hunspell

# If you want to compile the Mozilla Calendar, uncomment this line:
#ac_add_options --enable-calendar

# Comment out following options if you have not installed
# recommended dependencies:
# Do not use system SQLite for Thunderbird 45.x
#ac_add_options --enable-system-sqlite
ac_add_options --with-system-libevent
ac_add_options --with-system-libvpx
ac_add_options --with-system-nspr
ac_add_options --with-system-nss
ac_add_options --with-system-icu

# The BLFS editors recommend not changing anything below this line:
ac_add_options --prefix=
ac_add_options --enable-application=mail

ac_add_options --disable-crashreporter
ac_add_options --disable-installer
ac_add_options --disable-updater
ac_add_options --disable-debug
ac_add_options --disable-tests

ac_add_options --enable-optimize
ac_add_options --enable-strip
ac_add_options --enable-install-strip

ac_add_options --enable-gio
ac_add_options --enable-official-branding
ac_add_options --enable-safe-browsing
ac_add_options --enable-url-classifier

ac_add_options --disable-dbus
ac_add_options --disable-gstreamer
ac_add_options --disable-libnotify
ac_add_options --disable-necko-wifi
ac_add_options --disable-pulseaudio
ac_add_options --disable-gconf
# build fails with webm disabled for some reason
#ac_add_options --disable-webm

# Use internal cairo due to reports of unstable execution with
# system cairo
#ac_add_options --enable-system-cairo
ac_add_options --enable-system-ffi
ac_add_options --enable-system-pixman

ac_add_options --with-pthreads

ac_add_options --with-system-bz2
ac_add_options --with-system-jpeg
ac_add_options --with-system-png
ac_add_options --with-system-zlib</literal>
EOF</userinput></screen>

    <para>
      Compile the package:
    </para>

<!--<screen><userinput>SHELL=/bin/sh make -f client.mk</userinput></screen>-->
<screen><userinput>sed -e '/#include/i\
    print OUT "#define _GLIBCXX_INCLUDE_NEXT_C_HEADERS\\n"\;' \
    -i mozilla/nsprpub/config/make-system-wrappers.pl &amp;&amp;
sed -e '/#include/a\
    print OUT "#undef _GLIBCXX_INCLUDE_NEXT_C_HEADERS\\n"\;' \
    -i mozilla/nsprpub/config/make-system-wrappers.pl &amp;&amp;
SHELL=/bin/sh \
CFLAGS="-fno-delete-null-pointer-checks -fno-lifetime-dse -fno-schedule-insns2" \
CXXFLAGS="-fno-delete-null-pointer-checks -fno-lifetime-dse -fno-schedule-insns2" \
make -f client.mk</userinput></screen>

    <para>
      Install the package:
    </para>

<screen role="root"><userinput>porg -lD -E $PWD "make -f client.mk install INSTALL_SDK= &amp;&amp;
chown -R 0:0 /lib/thunderbird-&thunderbird-version;"</userinput></screen>

    <sect3>
      <title>Command Explanations</title>

      <para>
        <command>sed ...</command>: These commands correct the source to be
        compatible with gcc6 by preventing C++ scope errors.
      </para>

      <para>
        <command>CFLAGS= ... CXXFLAGS= ...</command>: These settings work
        around code which gcc6 would otherwise regard as out-of-specification
        and allow it to produce a working program.
      </para>

      <para>
        <command>make -f client.mk</command>: Mozilla products are packaged to
        allow the use of a configuration file which can be used to pass the
        configuration settings to the <command>configure</command> command.
        <command>make</command> uses the <filename>client.mk</filename> file to
        get initial configuration and setup parameters.
      </para>

    </sect3>

  </sect2>

</sect1>
