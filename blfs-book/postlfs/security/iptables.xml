<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY iptables-homepage      "http://www.netfilter.org/projects/iptables/">
  <!ENTITY iptables-wikipedia     "https://en.wikipedia.org/wiki/Iptables">
  <!ENTITY iptables-download-http "http://www.netfilter.org/projects/iptables/files/iptables-&iptables-version;.tar.bz2">
  <!ENTITY iptables-download-ftp  "ftp://ftp.netfilter.org/pub/iptables/iptables-&iptables-version;.tar.bz2">
  <!ENTITY iptables-md5sum        "27ba3451cb622467fc9267a176f19a31">
  <!ENTITY iptables-size          "596 KB">
  <!ENTITY iptables-buildsize     "19 MB">
  <!ENTITY iptables-time          "0.1 SBU">
]>

<sect1 id="iptables" xreflabel="iptables-&iptables-version;">
  <?dbhtml filename="iptables.html"?>

  <title>iptables-&iptables-version;</title>

  <sect2 role="package">
    <title>Introduction</title>

    <para>
      The next part of this chapter deals with firewalls. The principal
      firewall tool for Linux is iptables. You will need to install iptables if
      you intend on using any form of a firewall.
    </para>

    <bridgehead renderas="sect3">Package Information</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Homepage: <ulink url="&iptables-homepage;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Wikipedia: <ulink url="&iptables-wikipedia;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Download (HTTP): <ulink url="&iptables-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Download (FTP): <ulink url="&iptables-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Download MD5 sum: &iptables-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Download size: &iptables-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimated disk space required: &iptables-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimated build time: &iptables-time;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dependencies</bridgehead>

    <bridgehead renderas="sect4">Optional</bridgehead>
    <para>
      <ulink url="http://www.netfilter.org/projects/nftables/index.html">nftables</ulink>
    </para>

  </sect2>

  <sect2>
    <title>Kernel Configuration</title>

    <para>
      A firewall in Linux is accomplished through a portion of the kernel
      called netfilter. The interface to netfilter is iptables. To use it, the
      appropriate kernel configuration parameters are found in:
    </para>

<screen><literal>[*] Networking support  ---&gt;                                    [CONFIG_NET]
      Networking Options  ---&gt;
        [*] Network packet filtering framework (Netfilter) ---&gt; [CONFIG_NETFILTER]</literal></screen>

  </sect2>

  <sect2>
    <title>Installation</title>

    <note>
      <para>
        The installation below does not include building some specialized
        extension libraries which require the raw headers in the Linux source
        code. If you wish to build the additional extensions (if you aren't
        sure, then you probably don't), you can look at the
        <filename>INSTALL</filename> file to see an example of how to change
        the <parameter>KERNEL_DIR=</parameter> parameter to point at the Linux
        source code. Note that if you upgrade the kernel version, you may also
        need to recompile iptables and that the BLFS team has not tested using
        the raw kernel headers.
      </para>

      <para>
        For some non-x86 architectures, the raw kernel headers may be required.
        In that case, modify the <parameter>KERNEL_DIR=</parameter> parameter
        to point at the Linux source code.
      </para>
    </note>

    <para>
      Prepare the package:
    </para>

<screen><userinput>./configure --prefix= \
            --sbindir=/bin \
            --disable-nftables</userinput></screen>

    <para>
      Build the package:
    </para>

<screen><userinput>make</userinput></screen>

    <para>
      Install the package:
    </para>

<screen><userinput>porg -lp iptables-&iptables-version; -E $PWD "make -j1 install &amp;&amp;
ln -sfv xtables-multi /bin/iptables-xml &amp;&amp;
rm -v /lib/libip4tc.la &amp;&amp;
rm -v /lib/libip6tc.la &amp;&amp;
rm -v /lib/libiptc.la &amp;&amp;
rm -v /lib/libxtables.la"</userinput></screen>

    <sect3>
      <title>Explanation</title>

      <para>
        <parameter>--disable-nftables</parameter>: This switch disables
        building nftables compat.
      </para>

      <para>
        <option>--enable-libipq</option>: This switch enables building of
        <filename class="libraryfile">libipq.so</filename> which can be used by
        some packages outside of BLFS.
      </para>

      <para>
        <option>--enable-nfsynproxy</option>: This switch enables installation
        of nfsynproxy SYNPROXY configuration tool.
      </para>

      <para>
        <command>ln -sfv xtables-multi /bin/iptables-xml</command>: Ensure the
        symbolic link for <command>iptables-xml</command> is relative.
      </para>

    </sect3>

  </sect2>

  <sect2>
    <title>Configuration</title>

    <para>
      Introductory instructions for configuring your firewall are presented in
      the next section: <xref linkend="fw-firewall"/>
    </para>

    <sect3>
      <title>Boot Script</title>

      <para>
        To set up the iptables firewall at boot, install the
        <filename>/etc/rc.d/init.d/iptables</filename> init script included in
        the <xref linkend="bootscripts"/> package.
      </para>

<screen><userinput>porg -lp+ iptables-&iptables-version; "make install-iptables"</userinput></screen>

    </sect3>

  </sect2>

</sect1>
