<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY openssh-homepage      "http://www.openssh.org/">
  <!ENTITY openssh-wikipedia     "http://en.wikipedia.org/wiki/OpenSSH">
  <!ENTITY openssh-download-http "http://ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-&openssh-version;.tar.gz">
  <!ENTITY openssh-download-ftp  "ftp://ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-&openssh-version;.tar.gz">
  <!ENTITY openssh-md5sum        "13009a9156510d8f27e752659075cced">
  <!ENTITY openssh-size          "1.5 MB">
  <!ENTITY openssh-buildsize     "37 MB">
  <!ENTITY openssh-time          "0.4 SBU">
]>

<sect1 id="openssh" xreflabel="openssh-&openssh-version;">
  <?dbhtml filename="openssh.html"?>

  <title>openssh-&openssh-version;</title>

  <sect2 role="package">
    <title>Introduction</title>

  <para>
    The OpenSSH package contains <command>ssh</command> clients and the
    <command>sshd</command> daemon. This is useful for encrypting authentication
    and subsequent traffic over a network. The <command>ssh</command> and
    <command>scp</command> commands are secure implementions of
    <command>telnet</command> and <command>rcp</command> respectively.
  </para>

    <bridgehead renderas="sect3">Package Information</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Homepage: <ulink url="&openssh-homepage;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Wikipedia: <ulink url="&openssh-wikipedia;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Download (HTTP): <ulink url="&openssh-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Download (FTP): <ulink url="&openssh-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Download MD5 sum: &openssh-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Download size: &openssh-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimated disk space required: &openssh-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimated build time: &openssh-time;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dependencies</bridgehead>

    <bridgehead renderas="sect4">Required</bridgehead>
    <para>
      <xref linkend="libressl"/>
    </para>

    <bridgehead renderas="sect4">Optional</bridgehead>
    <para>
      <xref linkend="libedit"/>,
      <xref linkend="x-window-system"/>,
      <ulink url="http://www.opensc-project.org/">OpenSC</ulink> and
      <ulink url="http://www.citi.umich.edu/projects/smartcard/sectok.html">libsectok</ulink>
    </para>

  </sect2>

  <sect2>
    <title>Installation</title>

    <para>
      OpenSSH runs as two processes when connecting to other computers. The
      first process is a privileged process and controls the issuance of
      privileges as necessary. The second process communicates with the network.
      Additional installation steps are necessary to set up the proper
      environment, which are performed by issuing the following commands as the
      <systemitem class="username">root</systemitem> user:
    </para>

<screen role="root"><userinput>install -v -m700 -d /var/lib/sshd &amp;&amp;
chown -v root:sys /var/lib/sshd &amp;&amp;
adduser -g 'sshd PrivSep' -h /var/lib/sshd \
    -s /bin/false -u 50 -D -H sshd</userinput></screen>

    <para>
      Prepare the package for compilation:
    </para>

<screen><userinput>./configure --prefix= \
            --sbindir=/bin \
            --sysconfdir=/etc/ssh \
            --with-mantype=doc \
            --with-md5-passwords \
            --with-privsep-path=/var/lib/sshd \
            --with-default-path=/bin</userinput></screen>

    <para>
      Compile the package:
    </para>

<screen><userinput>make</userinput></screen>

    <para>
      Install the package:
    </para>

<screen role="root"><userinput>porg -lD "make -j1 install &amp;&amp;
install -v -m755 contrib/ssh-copy-id /bin &amp;&amp;
install -v -m644 contrib/ssh-copy-id.1 /share/man/man1"</userinput></screen>

    <sect3>
      <title>Command Explanations</title>

      <para>
        <parameter>--sysconfdir=/etc/ssh</parameter>: This prevents the
        configuration files from being installed in <filename
        class="directory">/usr/etc</filename>.
      </para>

      <para>
        <parameter>--with-md5-passwords</parameter>: This enables the use of MD5
        passwords.
      </para>

      <para>
        <option>--with-xauth=/bin/xauth</option>: Set the default location
        for the <command>xauth</command> binary for X authentication. This can
        also be controlled from <filename>sshd_config</filename> with the
        XAuthLocation keyword. You can omit this switch if Xorg is already
        installed.
      </para>

      <para>
        <option>--with-libedit</option>: This option enables line editing and
        history features for <command>sftp</command>.
      </para>

    </sect3>

  </sect2>

  <sect2>
    <title>Configuration</title>

    <para>
      There are no required changes to any of these files. However,
      you may wish to view the
      <filename class='directory'>/etc/ssh/</filename> files and make any
      changes appropriate for the security of your system. One recommended
      change is that you disable
      <systemitem class='username'>root</systemitem> login via
      <command>ssh</command>. Execute the following command as the
      <systemitem class='username'>root</systemitem> user to disable
      <systemitem class='username'>root</systemitem> login via
      <command>ssh</command>:
    </para>

<screen role="root"><userinput>echo "PermitRootLogin no" &gt;&gt; /etc/ssh/sshd_config</userinput></screen>

    <para>
      If you want to be able to log in without typing in your password, first
      create ~/.ssh/id_rsa and ~/.ssh/id_rsa.pub with
      <command>ssh-keygen</command> and then copy ~/.ssh/id_rsa.pub to
      ~/.ssh/authorized_keys on the remote computer that you want to log into.
      You'll need to change REMOTE_USERNAME and REMOTE_HOSTNAME for the username and hostname of the remote
      computer and you'll also need to enter your password for the ssh-copy-id command
      to succeed:
    </para>

<screen><userinput>ssh-keygen &amp;&amp;
ssh-copy-id -i ~/.ssh/id_rsa.pub <replaceable>REMOTE_USERNAME</replaceable>@<replaceable>REMOTE_HOSTNAME</replaceable></userinput></screen>

    <para>
      Once you've got passwordless logins working it's actually more secure
      than logging in with a password (as the private key is much longer than
      most people's passwords). If you would like to now disable password
      logins, as the <systemitem class="username">root</systemitem> user:
    </para>


<screen role="root"><userinput>echo "PasswordAuthentication no" >> /etc/ssh/sshd_config &amp;&amp;
echo "ChallengeResponseAuthentication no" >> /etc/ssh/sshd_config</userinput></screen>

    <para>
      Additional configuration information can be found in the man
      pages for <command>sshd</command>, <command>ssh</command> and
      <command>ssh-agent</command>.
    </para>

    <sect3>
      <title>Boot Script</title>

      <para>
        To start the SSH server at system boot, install the
        <filename>/etc/rc.d/init.d/sshd</filename> init script included in the
        <xref linkend="bootscripts"/> package.
      </para>

<screen role="root"><userinput>porg -lp+ openssh-&openssh-version; "make -j1 install-sshd"</userinput></screen>

    </sect3>

  </sect2>

</sect1>
