<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY dhcp-homepage      " ">
  <!ENTITY dhcp-wikipedia     " ">
  <!ENTITY dhcp-download-http " ">
  <!ENTITY dhcp-download-ftp  "ftp://ftp.isc.org/isc/dhcp/&dhcp-version;/dhcp-&dhcp-version;.tar.gz">
  <!ENTITY dhcp-md5sum        "2b5e5b2fa31c2e27e487039d86f83d3f">
  <!ENTITY dhcp-size          "9.6 MB">
  <!ENTITY dhcp-buildsize     "238 MB">
  <!ENTITY dhcp-time          "0.6 SBU">
]>

<sect1 id="dhcp" xreflabel="dhcp-&dhcp-version;">
  <?dbhtml filename="dhcp.html"?>

  <title>dhcp-&dhcp-version;</title>

  <sect2 role="package">
    <title>Introduction</title>

    <para>
      The ISC DHCP package contains both the client program for DHCP.
      <command>dhclient</command> (the client) is used for connecting to a
      network which uses DHCP to assign network addresses.
    </para>

    <bridgehead renderas="sect3">Package Information</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Homepage: <ulink url="&dhcp-homepage;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Wikipedia: <ulink url="&dhcp-wikipedia;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Download (HTTP): <ulink url="&dhcp-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Download (FTP): <ulink url="&dhcp-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Download MD5 sum: &dhcp-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Download size: &dhcp-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimated disk space required: &dhcp-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimated build time: &dhcp-time;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Additional Downloads</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Required patch:
          <ulink url="&patch-root;dhcp/dhcp-&dhcp-version;-client_script-p.patch"/>
        </para>
      </listitem>
    </itemizedlist>

  </sect2>

  <sect2>
    <title>Kernel Configuration</title>

    <para>
      You must have Packet Socket support:
    </para>

<screen><literal>[*] Networking support ---&gt;          [CONFIG_NET]
      Networking options ---&gt;
        &lt;*&gt; Packet socket            [CONFIG_PACKET]</literal></screen>

  </sect2>

  <sect2>
    <title>Installation</title>

    <note>
      <para>
        This package does not support parallel build.
      </para>
    </note>

    <note>
      <para>
        Be careful with the instructions below. The single and
        double quotes are important because the defined
        variables are used verbatim in the code.
      </para>
    </note>

    <para>
      Prepare the package for compilation:
    </para>

<screen><userinput>patch -p1 -i ../dhcp-&dhcp-version;-client_script-p.patch &amp;&amp;
CFLAGS="-D_PATH_DHCLIENT_SCRIPT='\"/bin/dhclient-script\"' \
        -D_PATH_DHCPD_CONF='\"/etc/dhcp/dhcpd.conf\"' \
        -D_PATH_DHCLIENT_CONF='\"/etc/dhcp/dhclient.conf\"'" &amp;&amp;
export CFLAGS &amp;&amp;
./configure --prefix= \
            --sbindir=/bin \
            --sysconfdir=/etc/dhcp \
            --with-srv-lease-file=/var/lib/dhcpd/dhcpd.leases \
            --with-srv6-lease-file=/var/lib/dhcpd/dhcpd6.leases \
            --with-cli-lease-file=/var/lib/dhclient/dhclient.leases \
            --with-cli6-lease-file=/var/lib/dhclient/dhclient6.leases &amp;&amp;
unset CFLAGS</userinput></screen>

    <para>
      Compile the package:
    </para>

<screen><userinput>make -j1</userinput></screen>


    <para>
      Install the package:
    </para>

<screen role="root"><userinput>porg -lD "make -C client -j1 install &amp;&amp;
install -v -m755 client/scripts/linux /bin/dhclient-script"</userinput></screen>

  </sect2>

  <sect2>
    <title>Configuration</title>

    <para>
      Create basic <filename>/etc/dhcp/dhclient.conf</filename> by running the
      following command as the <systemitem class="username">root</systemitem>
      user:
    </para>

<screen role="root"><userinput>install -vdm755 /etc/dhcp &amp;&amp;
cat &gt; /etc/dhcp/dhclient.conf &lt;&lt; "EOF"
<literal># Begin /etc/dhcp/dhclient.conf
#
# Basic dhclient.conf(5)

#prepend domain-name-servers 127.0.0.1;
request subnet-mask, broadcast-address, time-offset, routers,
        domain-name, domain-name-servers, domain-search, host-name,
        netbios-name-servers, netbios-scope, interface-mtu,
        ntp-servers;
require subnet-mask, domain-name-servers;
#timeout 60;
#retry 60;
#reboot 10;
#select-timeout 5;
#initial-interval 2;

# End /etc/dhcp/dhclient.conf</literal>
EOF
ls /etc/dhcp/dhclient.conf | porg -lD+</userinput></screen>

    <para>
      See <command>man 5 dhclient.conf</command> for additional options.
    </para>

    <para>
      Now create the <filename class="directory">/var/lib/dhclient</filename>
      directory which will contain DHCP Client leases by running the following
      command as the <systemitem class="username">root</systemitem> user:
    </para>

<screen role="root"><userinput>install -v -dm 755 /var/lib/dhclient</userinput></screen>

    <para>
      At this point you can test if <command>dhclient</command> is behaving as
      expected by running the following command as the <systemitem
      class="username">root</systemitem> user:
    </para>

<screen role="root"><userinput>dhclient <replaceable>&lt;eth0&gt;</replaceable></userinput></screen>

    <para>
      Replace <replaceable>&lt;eth0&gt;</replaceable> with your desired
      interface. If you want more verbose output, add the <command>-v</command>
      parameter to the command above.
    </para>

    <para id="dhclient-service">
      If you want to configure network interfaces at boot using
      <command>dhclient</command>, you need to install the
      <filename>/lib/services/dhclient</filename> script included in <xref
      linkend="bootscripts"/> package:
    </para>

<screen role="root"><userinput>porg -lp+ dhcp-&dhcp-version; "make -j1 install-service-dhclient"</userinput></screen>

    <para id="dhclient-ifconfig">
      Next, create the <filename>/etc/sysconfig/ifconfig.eth0</filename>
      configuration file with the following commands as the <systemitem
      class="username">root</systemitem> user:
    </para>

<screen role="root"><userinput>cat &gt; /etc/sysconfig/ifconfig.eth0 &lt;&lt; "EOF"
<literal>ONBOOT="yes"
IFACE="eth0"
SERVICE="dhclient"
DHCP_START=""
DHCP_STOP=""

# Set PRINTIP="yes" to have the script print
# the DHCP assigned IP address
PRINTIP="no"

# Set PRINTALL="yes" to print the DHCP assigned values for
# IP, SM, DG, and 1st NS. This requires PRINTIP="yes".
PRINTALL="no"</literal>
EOF</userinput></screen>

    <para>
      Adjust the file to suit your needs.
    </para>

    <para>
      For more information on the appropriate <envar>DHCP_START</envar> and
      <envar>DHCP_STOP</envar> values see <command>man 8 dhclient</command>.
    </para>

  </sect2>

</sect1>
