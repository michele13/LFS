<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  %general-entities;
]>

<sect1 id="ch-system-busybox" role="wrap">
  <?dbhtml filename="busybox.html"?>

  <sect1info condition="script">
    <productname>busybox</productname>
    <productnumber>&busybox-version;</productnumber>
    <address>&busybox-url;</address>
  </sect1info>

  <title>BusyBox-&busybox-version;</title>

  <indexterm zone="ch-system-busybox">
    <primary sortas="a-BusyBox">BusyBox</primary>
  </indexterm>

  <sect2 role="package">
    <title/>

    <para>
      BusyBox combines tiny versions of many common UNIX utilities into a single
      small executable. It provides replacements for most of the utilities you
      usually find in GNU fileutils, shellutils, etc. The utilities in BusyBox
      generally have fewer options than their full-featured GNU cousins;
      however, the options that are included provide the expected functionality
      and behave very much like their GNU counterparts.
    </para>

    <segmentedlist>
      <segtitle>&buildtime;</segtitle>
      <segtitle>&diskspace;</segtitle>

      <seglistitem>
        <seg>&busybox-ch6-sbu;</seg>
        <seg>&busybox-ch6-du;</seg>
      </seglistitem>
    </segmentedlist>

  </sect2>

  <sect2 role="installation">
    <title>Installation of BusyBox</title>

    <para>Prepare BusyBox for compilation:</para>

<screen><userinput remap="configure">make defconfig</userinput></screen>

    <para>Instead of using the default DES method, use the more secure SHA-512
    method of password encryption:</para>

<screen><userinput remap="configure">sed '/CONFIG_FEATURE_DEFAULT_PASSWD_ALGO/ s/des/sha512/' -i .config</userinput></screen>

    <para>Disable simplified modutils and enable standard utilities for loading
    kernel modules:</para>

<screen><userinput remap="configure">sed -e 's/\(CONFIG_MODPROBE_SMALL\)=y/# \1 is not set/' \
    -e 's/# \(CONFIG_INSMOD\) is not set/\1=y/' \
    -e 's/# \(CONFIG_RMMOD\) is not set/\1=y/' \
    -e 's/# \(CONFIG_LSMOD\) is not set/\1=y/' \
    -e 's/# \(CONFIG_FEATURE_LSMOD_PRETTY_2_6_OUTPUT\) is not set/\1=y/' \
    -e 's/# \(CONFIG_MODPROBE\) is not set/\1=y/' \
    -e 's/# \(CONFIG_FEATURE_MODPROBE_BLACKLIST\) is not set/\1=y/' \
    -e 's/# \(CONFIG_DEPMOD\) is not set/\1=y/' \
    -e 's/# \(CONFIG_FEATURE_CHECK_TAINTED_MODULE\) is not set/\1=y/' \
    -e 's/# \(CONFIG_FEATURE_MODUTILS_ALIAS\) is not set/\1=y/' \
    -e 's/# \(CONFIG_FEATURE_MODUTILS_SYMBOLS\) is not set/\1=y/' -i .config</userinput></screen>

<!--
    <para>Disable support for programs which will be installed from the e2fsprogs package:</para>

<screen><userinput remap="configure">sed -e 's/\(CONFIG_CHATTR\)=y/# \1 is not set/' \
    -e 's/\(CONFIG_FSCK\)=y/# \1 is not set/' \
    -e 's/\(CONFIG_LSATTR\)=y/# \1 is not set/' \
    -e 's/\(CONFIG_MKFS_EXT2\)=y/# \1 is not set/' -i .config</userinput></screen>

    <para>Disable support for programs which will be installed from the kbd package:</para>

<screen><userinput remap="configure">sed -e 's/\(CONFIG_CHVT\)=y/# \1 is not set/' \
    -e 's/\(CONFIG_FGCONSOLE\)=y/# \1 is not set/' \
    -e 's/\(CONFIG_DEALLOCVT\)=y/# \1 is not set/' \
    -e 's/\(CONFIG_DUMPKMAP\)=y/# \1 is not set/' \
    -e 's/\(CONFIG_KBD_MODE\)=y/# \1 is not set/' \
    -e 's/\(CONFIG_LOADFONT\)=y/# \1 is not set/' \
    -e 's/\(CONFIG_LOADKMAP\)=y/# \1 is not set/' \
    -e 's/\(CONFIG_OPENVT\)=y/# \1 is not set/' \
    -e 's/\(CONFIG_SETFONT\)=y/# \1 is not set/' \
    -e 's/\(CONFIG_SETKEYCODES\)=y/# \1 is not set/' \
    -e 's/\(CONFIG_SHOWKEY\)=y/# \1 is not set/' -i .config</userinput></screen>
-->

    <para>Compile the package:</para>

<screen><userinput remap="make">make</userinput></screen>

    <para>Install the package:</para>

<!--
     # ping, su and vlock for regular user require setuid root
     chmod -v +s /bin/busybox
-->
<screen><userinput remap="install">porg -lD "install -v -m 755 busybox /bin"
for program in cat echo pwd sh stty ; do porg -lD+ "ln -sfv busybox /bin/$program" ; done
for program in addgroup adduser ash base64 basename blockdev bunzip2 \
bzcat bzip2 cal chgrp chmod chown chpasswd chroot chrt cksum cmp comm cp cpio \
cut date dc dd delgroup deluser depmod df diff dirname dmesg dnsdomainname \
du egrep eject env expand expr false fdformat fdisk fgrep find flock \
fold free fstrim fuser getopt getty grep groups gunzip gzip \
halt hd head hexdump hostid hostname hwclock id ifconfig init \
insmod install ionice iostat ip ipcrm ipcs kill killall killall5 klogd last \
linux32 linux64 ln logger login logname losetup ls lsmod \
lzcat lzma md5sum mdev mkdir mkfifo mknod mkswap \
mktemp modinfo modprobe more mount mountpoint mpstat mv netstat nice nohup \
nslookup od passwd pgrep pidof ping ping6 pivot_root pkill pmap \
poweroff printenv printf ps pstree pwdx readlink readprofile realpath reboot \
renice rev rm rmdir rmmod route rtcwake runlevel script scriptreplay sed seq \
setarch setsid sha1sum sha256sum sha3sum sha512sum shuf sleep sort split stat \
su sulogin sum swapoff swapon switch_root sync sysctl syslogd tac tail tar \
tee telnet test tftp time timeout top touch tr traceroute \
traceroute6 true tty umount uname unexpand uniq unlink unlzma unxz \
uptime users uudecode uuencode vi vlock wall watch wc wget which who \
whoami xargs xz xzcat yes zcat ; do porg -lD+ "ln -sv busybox /bin/$program" ; done</userinput></screen>
<!--
    <para>Install the e2fsprogs part of the package:</para>

<screen><userinput remap="install">porg -lp busybox-e2fsprogs-&busybox-version; "
ln -sfv busybox /bin/blkid &amp;&amp;
ln -sfv busybox /bin/chattr &amp;&amp;
ln -sfv busybox /bin/findfs &amp;&amp;
ln -sfv busybox /bin/fsck &amp;&amp;
ln -sfv busybox /bin/lsattr &amp;&amp;
ln -sfv busybox /bin/mke2fs &amp;&amp;
ln -sfv busybox /bin/mkfs.ext2"</userinput></screen>
-->
    <para>Install the patch part of the package:</para>

<screen><userinput remap="install">porg -lp busybox-patch-&busybox-version; "ln -sfv busybox /bin/patch"</userinput></screen>

  </sect2>

  <sect2 role="configuration">
    <title>Configuration</title>

    <para>Choose a password for user <emphasis>root</emphasis> and set it
    by running:</para>

<screen role="nodump"><userinput>passwd root</userinput></screen>

    <para>Create a new <filename>/etc/syslog.conf</filename> file by running the
    following:</para>

<screen><userinput>cat &gt; /etc/syslog.conf &lt;&lt; "EOF"
<literal># Begin /etc/syslog.conf

auth,authpriv.* /var/log/auth.log
*.*;auth,authpriv.none /var/log/sys.log
daemon.* /var/log/daemon.log
kern.* /var/log/kern.log
mail.* /var/log/mail.log
user.* /var/log/user.log
*.emerg *

# End /etc/syslog.conf</literal>
EOF
ls /etc/syslog.conf | porg -lD+</userinput></screen>

  </sect2>

</sect1>
