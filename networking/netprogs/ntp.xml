<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY ntp-homepage      "http://www.ntp.org/">
  <!ENTITY ntp-wikipedia
  "https://en.wikipedia.org/wiki/Network_Time_Protocol">
  <!ENTITY ntp-download-http
  "http://www.eecis.udel.edu/~ntp/ntp_spool/ntp4/ntp-4.2/ntp-&ntp-version;.tar.gz">
  <!ENTITY ntp-download-ftp  " ">
  <!ENTITY ntp-md5sum        "00df80a84ec9528fcfb09498075525bc">
  <!ENTITY ntp-size          "4.1 MB">
  <!ENTITY ntp-buildsize     "48 MB">
  <!ENTITY ntp-time          "0.5 SBU">
]>

<sect1 id="ntp" xreflabel="ntp-&ntp-version;">
  <?dbhtml filename="ntp.html"?>

  <title>ntp-&ntp-version;</title>

  <indexterm zone="ntp">
    <primary sortas="a-ntp">ntp</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduction</title>

    <para>
      The ntp package contains a client and server to keep the time synchronized
      between various computers over a network. This package is the official
      reference implementation of the NTP protocol.
    </para>

    <bridgehead renderas="sect3">Package Information</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Homepage: <ulink url="&ntp-homepage;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Wikipedia: <ulink url="&ntp-wikipedia;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Download (HTTP): <ulink url="&ntp-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Download (FTP): <ulink url="&ntp-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Download MD5 sum: &ntp-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Download size: &ntp-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimated disk space required: &ntp-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Estimated build time: &ntp-time;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dependencies</bridgehead>

    <bridgehead renderas="sect4">Recommended</bridgehead>
    <para role="recommended">
      <xref linkend="libcap"/>
    </para>

    <bridgehead renderas="sect4">Optional</bridgehead>
    <para role="optional">
      <xref linkend="openssl"/>
    </para>

  </sect2>

  <sect2 role="installation">
    <title>Installation</title>

    <para>
      There should be a dedicated user and group to take control of the
      <command>ntpd</command> daemon after it is started. Issue the following
      commands as the <systemitem class="username">root</systemitem> user:
    </para>

<screen role="root"><userinput>groupadd -g 87 ntp &amp;&amp;
useradd -c "Network Time Protocol" -d /var/lib/ntp -u 87 \
        -g ntp -s /bin/false ntp</userinput></screen>

    <para>
      Install ntp by running the following commands:
    </para>

<screen><userinput>./configure --prefix=/usr \
            --sysconfdir=/etc \
            --with-binsubdir=sbin \
            --with-lineeditlibs=readline &amp;&amp;
make</userinput></screen>

    <para>
      Now, as the <systemitem class="username">root</systemitem> user:
    </para>

<screen role="root"><userinput>make install &amp;&amp;
install -v -o ntp -g ntp -d /var/lib/ntp</userinput></screen>

    <sect3>
      <title>Command Explanations</title>

      <para>
        <parameter>--with-binsubdir=sbin</parameter>: This parameter places the
        administrative programs in <filename
        class="directory">/usr/sbin</filename>.
      </para>

      <para>
        <parameter>--with-lineeditlibs=readline</parameter>: This parameter
        enables Readline support for <command>ntpdc</command> and
        <command>ntpq</command> programs. If omitted, libedit will be used if
        installed, otherwise no readline capabilites will be compiled.
      </para>

    </sect3>

  </sect2>

  <sect2 role="configuration">
    <title>Configuration</title>

    <para>
      The following configuration file defines various ntp servers with open
      access from different continents. It also creates a drift file where
      <command>ntpd</command> stores the frequency offset and a pid file to
      store the <command>ntpd</command> process ID. Since the documentation
      included with the package is sparse, visit the ntp website at <ulink
      url="http://www.ntp.org/"/> and <ulink url="http://www.pool.ntp.org/"/>
      for more information.
    </para>

<screen role="root"><userinput>cat &gt; /etc/ntp.conf &lt;&lt; "EOF"
<literal># Asia
server 0.asia.pool.ntp.org

# Australia
server 0.oceania.pool.ntp.org

# Europe
server 0.europe.pool.ntp.org

# North America
server 0.north-america.pool.ntp.org

# South America
server 2.south-america.pool.ntp.org

driftfile /var/lib/ntp/ntp.drift
pidfile   /var/run/ntpd.pid</literal>
EOF</userinput></screen>

    <sect3 id="ntp-init">
      <title>Synchronizing the Time</title>

      <para>
        There are two options. Option one is to run <command>ntpd</command>
        continuously and allow it to synchronize the time in a gradual manner.
        The other option is to run <command>ntpd</command> periodically (using
        cron) and update the time each time <command>ntpd</command> is
        scheduled.
      </para>

      <para>
        If you choose option one, then install the
        <filename>/etc/rc.d/init.d/ntp</filename> init script included in the
        <xref linkend="bootscripts"/> package.
      </para>


<screen role="root"><userinput>make install-ntpd</userinput></screen>

      <para>
        If you prefer to run <command>ntpd</command> periodically, add the
        following command to <systemitem class="username">root</systemitem>'s
        <filename>crontab</filename>:
      </para>

<screen><literal>ntpd -q</literal></screen>

      <para>
        Execute the following command if you would like to set the hardware
        clock to the current system time at shutdown and reboot:
      </para>

<screen role="root"><userinput>ln -v -sf ../init.d/setclock /etc/rc.d/rc0.d/K46setclock &amp;&amp;
ln -v -sf ../init.d/setclock /etc/rc.d/rc6.d/K46setclock</userinput></screen>

      <para>
        The other way around is already set up by LFS.
      </para>

    </sect3>

  </sect2>

  <sect2 role="content">
    <title>Contents</title>

    <indexterm zone="ntp">
      <primary sortas="b-ntpd">ntpd</primary>
    </indexterm>
    <indexterm zone="ntp">
      <primary sortas="b-ntpdate">ntpdate</primary>
    </indexterm>
    <indexterm zone="ntp">
      <primary sortas="b-ntpdc">ntpdc</primary>
    </indexterm>
    <indexterm zone="ntp">
      <primary sortas="b-ntp-keygen">ntp-keygen</primary>
    </indexterm>
    <indexterm zone="ntp">
      <primary sortas="b-ntpq">ntpq</primary>
    </indexterm>
    <indexterm zone="ntp">
      <primary sortas="b-ntptime">ntptime</primary>
    </indexterm>
    <indexterm zone="ntp">
      <primary sortas="b-ntptrace">ntptrace</primary>
    </indexterm>
    <indexterm zone="ntp">
      <primary sortas="b-ntp-wait">ntp-wait</primary>
    </indexterm>
    <indexterm zone="ntp">
      <primary sortas="b-sntp">sntp</primary>
    </indexterm>
    <indexterm zone="ntp">
      <primary sortas="b-tickadj">tickadj</primary>
    </indexterm>
    <indexterm zone="ntp">
      <primary sortas="e-etc-ntp.conf">/etc/ntp.conf</primary>
    </indexterm>
    <indexterm zone="ntp">
      <primary sortas="f-ntp">ntp</primary>
    </indexterm>

    <para>
      Incomplete list of installed files and directories:
    </para>

<screen><literal>/etc/ntp.conf
/usr/sbin/ntpd
/usr/sbin/ntpdate
/usr/sbin/ntpdc
/usr/sbin/ntp-keygen
/usr/sbin/ntpq
/usr/sbin/ntptime
/usr/sbin/ntptrace
/usr/sbin/ntp-wait
/usr/sbin/sntp
/usr/sbin/tickadj
/usr/share/man/man1/ntpd.1
/usr/share/man/man1/ntpdc.1
/usr/share/man/man1/ntp-keygen.1
/usr/share/man/man1/ntpq.1
/usr/share/man/man1/ntpsnmpd.1
/usr/share/man/man1/sntp.1
/var/lib/ntp</literal></screen>

  </sect2>

</sect1>
